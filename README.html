<html>
	<head>
		<meta charset="utf-8"/>
		<title>SSI-AJAX</title>
		<script src="ssi-ajax.js" type="text/javascript"></script>
	</head>
	<body onload="load_includes()">

		<h1>This is SSI-AJAX</h1>

		<p>"SSH-AJAX" implements an "include" mechanism for HTML.</p>

		<p>By writing:

			<pre>&lt;ssi-ajax&gt;include virtual="included.html"&lt;/ssi-ajax&gt;</pre>
		</p>

		<p>that snippet of code will get replaced by the contents
		   of the "include.html" file.</p>

		<h2>Contents:</h2>

		<p><ul><li><a href="#why-ssi-ajax"         >Why would SSI-AJAX be useful?</a></li>
		       <li><a href="#requirements"         >What would the characteristics of an optimal include mechanisms be?</a></li>
		       <li><a href="#existing-shortcomings">Shortcomings of existing "include" mechanisms</a></li>
		       <li><a href="#mystery"              >Why doesn't HTML have a "include" mechanism</a></li>
		       <li><a href="#ssi-advantage"        >How does SSI-AJAX help?</a></li>
		       <li><a href="#ssi-shortcomings"     >Shortcomings of SSI-AJAX</a></li>
		       <li><a href="#usage"                >Usage</a></li>
		       <li><a href="#acknowledgements"     >Acknowledgements</a></li>
		       <li><a href="#references"           >References</a></li>
		    </ul>
		</p>

		<h2 id="why-ssi-ajax">Why would SSI-AJAX be useful?</h2>

		<p>When you have a web site, that contains the same page header
		   or footer on each web page, or the same navigation bar, then
		   SSI-AJAX let's you include that ever same content of every
		   page with a simple statement.</p>

		<h2 id="requirements">What would the characteristics of an optimal include mechanisms be?</h2>

		<p>One essential goal of an "include" mechanism for the web is
		   economic resource usage:

			<ul>
				<li>simplicity:
					<ul>
						<li>the machanism shouldn't require much
						    brain power to reason about</li>
						<li>the mechanism shouldn't require the
						    programmer to repeat himself or do
						    needless ceremony</li>
						<li>tmplementation on web-server and
						    web-client side should be easy,
						    simple and require little resources</li>
					</ul>
				</li>
				<li>no duplicate data transmission: if the client already
				    has the data, then the same data should not be
				    retransmitted over the network again. That saves:
					<ul>
						<li>computing power on the web-server</li>
						<li>bandwidth on the network</li>
						<li>computung power on the web-client/browser</li>
						<li>human time waiting for the data to appear</li>
					</ul>
				</li>
				<li>no gratuitous computation on the web-server or the
				    web-client:
					<ul>
						<li>if it can be done on the client, then it
						    should be done there to keep the
						    network/servers lean</li>
						<li>no computation should be required if
						    not necessary</li>
					</ul>
				</li>
			</ul>
		</p>

		<h2 id="existing-shortcomings">Shortcomings of existing "include" mechanisms</h2>

		<p>How do existing mechanisms fall short of the above stated criteriums?</p>

		<p>Today "includes" are either done:
			<ul>
				<li>via web frameworks on the server side, which means:
					<ul>
						<li>web-server compute resources are used to
						    process the same data over and over again
						</li>
						<li>bandwidth is wasted to transport the
						    same data again and again</li>
						<li>humans are needlessly waiting for the
						    same data to arive</li>
					</ul>
				</li>
				<li>via JavaScript AJAX calls. This is quite nice except that
					<ul>
						<li>JavaScript needs to be enabled on the
							client side
						</li>
						<li>compute power in JavaScript is needlessly
						    consumed to piece together web pages that
						    are possibly completely static</li>
					</ul>
				</li>
				<li>via HTML (i)frames. Usage of HTML frames is however very
				    problematic, stemming from the HTML frames' abstraction,
				    that every frame is practically it's own independent
				    browser or DOM tree or web page. Which means that among
				    other problems of frames:
				    	<ul>
						<li>it's impossible to include just the data
						    that one wants to repeat on every page,
						    but instead a whole HTML document needs
						    to be included in a frame
						</li>
				    	</ul>
				</li>
			</ul>
		</p>

		<h2 id="mystery">Why doesn't HTML have a "include" mechanism</h2>

		<p>That is quite a
		   <a href="https://github.com/whatwg/html/issues/331#issuecomment-242938547">mystery</a>.</p>

		<h2 id="ssi-advantage">How does SSI-AJAX help?</h2>

		<p>Since there is no "include" mechanism in HTML SSI-Java can:
			<ul>
				<li>do the including server-side, when JavaScript
				    is off on the client-side</li>
				<li>use AJAX on the client-side if JavaScript is
				    available</li>
			</ul>
		</p>

		<p>On the server side Apache's SSI
		   <a href="https://httpd.apache.org/docs/current/mod/mod_include.html">mod_include</a>
		   is used.</p>

		<p>On the client side custom JavaScript is used.</p>

		<p>Irrespective of whether the including is done on the client
		   or the server the inclusion syntax is always the same.</p>

		<h2 id="ssi-shortcomings">Shortcomings of SSI-AJAX</h2>

		<p>Currently the decision whether the including will be done
		   on the server or the client side is done based on the URL:
			<ul>
				<li>if the URL contains "/shtml/" in its path,
				    then the including is done on the server
				    side.
				</li>
				<li>otherwise the page content is delivered
				    to the browser unprocessed and the including
				    is expected to be done by JavaScript in the
				    browser.
				</li>
			</ul>
		</p>
		<p>The unsolved problem with this aproach is, that if the user
		   puts accesses a URL without "/shtml/" in it but does <b>not</b>
		   have JavaScript enabled, then the "&lt;ssi-ajax&gt;" tags
		   will not get replaced and thus the user will not see a
		   correctly rendered page.
		</p>
		<p>What is missing is a way to detect from the server side, whether
		   the client has JavaScript enabled.
		</p>
		<p>This could be achieved in part via UserAgent detection on the
		   server side, since JavaScript can <b>not</b> be disabled on
		   smartphone browsers. However that leaves the desktop browser
		   case unresolved.
		</p>

		<h2 id="#usage">Usage</h2>

		<h3>Inside your HTML</h3>

		<p>
			<pre>&lt;ssi-ajax&gt;include virtual="included.html"&lt;/ssi-ajax&gt;</pre>
		</p>

		<p>"included.html" is a URL. See
		   <a href="https://httpd.apache.org/docs/current/mod/mod_include.html#includevirtual">for reference</a>.</p>

		<h3>Apache-side configuration</h3>

		<p><a href="00-ssi-ajax.conf">00-ssi-ajax.conf</a> 
		   defines the "include" mechanism</p>
		
		<p><a href="ssi-ajax-demo.conf">ssi-ajax-demo.conf</a>
		   specifies which directory contains the HTML files
		   that get their includes replaced on the server-side.</p>
	       
		<p>Both config files should be added and enabled in
		   "/etc/apache2/conf-available" or similar. Make sure
		   that "00-ssi-ajax.conf" is read first by Apache, since
		   it is required by "ssi-ajax-demo.conf".</p>

		   It defines the "include" mechanism</p>
		
		<h3>HTML repository server-side</h3>

		<p>With the above Apache configuration only files in
		   directory "/shtml/" get processed server-side.</p>
		
		<p>To have a directory with HTML files that get
		   processed by the broser's JavaScript it's
		   easiest to create a symlink like this:
		   
		   <pre>ln -s shtml html</pre>
		   
		   Now, when accessing the HTML files via the "/html/"
		   reference, those files will be only processed by
		   JavaScript</p>

		<h2 id="#acknowledgements">Acknowledgements</h2>

		<p><ul><li>The syntax of the inclusion mechanism
		           ("ssi-ajax" tag) was inspired by
			   <a href="https://stackoverflow.com/a/46928819">Péter Vértényi's post</a></li>
		   </ul>
		</p>

		<h2 id="#references">References</h2>

		<p><ul><li><a href="https://httpd.apache.org/docs/current/mod/mod_include.html#element.include">Apache mod_include documentation</a></li>
		       <li><a href="https://stackoverflow.com/a/46928819">Péter Vértényi's idea to use custom elements</a></li>
		       <li>A few discussions on StackOverflow about a HTML "include" mechanisms:
		           <a href="https://stackoverflow.com/questions/3928331/equivalent-of-include-in-html">here</a>,
		           <a href="https://stackoverflow.com/questions/8988855/include-another-html-file-in-a-html-file">here</a>,
		           <a href="https://softwareengineering.stackexchange.com/questions/7245/why-no-client-side-html-include-tag#7256">here</a>.
		           <a href="https://stackoverflow.com/questions/7542872/how-to-include-one-html-file-into-another">here</a></li>
		       <li><a href="https://github.com/whatwg/html/issues/331">WhatWG's Tracker for the abandoned iframe seamless mechanism</a></li>
		       <li><a href="http://tpo.sourcepole.ch/articles/168%20html-http-considered-harmful.html">a critique of existing "include" mechanisms</a></li>
		   </ul>
		</p>
	</body>
</html>
